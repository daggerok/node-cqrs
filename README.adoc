= node-cqrs image:https://travis-ci.org/daggerok/node-cqrs.svg?branch=master["Build Status", link="https://travis-ci.org/daggerok/node-cqrs"]

_TODO: not yet finished..._

----
(ui update data) >>
    [produce command] >>
        [handle rabbit event] >>
            [save data into eventstore mongodb (master node)]
...
eventual consistency
...
(ui fetch data) >> | pooling | websockets | backpreassure
    [query view / projection] >>
        [get data from mongodb (replica node)]
----

done:

. implemented docker infrastructure: rabbitmq, mongo
. message-command app


.send message via REST API to RabbitMQ message broker
[sources,bash]
----
http post :3000/api/v1/messages payload='some data as messages.create type event'
----

.automation tests using docker swarm / docker stack deploy (required docker / swarm / compose and httpie installed)
[sources,bash]
----
yarn -i
bash docker/test-docker-compose.bash
----

.automation tests using docker-compose (required docker compose and httpie installed)
[sources,bash]
----
yarn -i
bash docker/test-docker-compose.bash
----

.manual testing using docker-compose (required docker compose and httpie installed)
[sources,bash]
----
yarn -i
docker-compose -f docker/docker-compose-all.yml up -d --build
http :3000
docker-compose -f docker/docker-compose-all.yml down -v
----

.update npm
[sources,bash]
----
yarn global add npm-check-updates
ncu -u
----

links:

. link:http://expressjs.com/en/4x/api.html[express]
. link:https://www.terlici.com/2015/04/03/mongodb-node-express.html[mongodb-express]
. link:https://www.rabbitmq.com/[rabbitmq]
. link:https://www.npmjs.com/package/servicebus[servicebus]
. link:https://github.com/mateodelnorte/servicebus-retry[servicebus-retry]
. link:https://github.com/mateodelnorte/servicebus-register-handlers[servicebus-register-handlers]
. link:https://github.com/mateodelnorte/servicebus-trace[servicebus-trace]
. link:http://nycnode.com/videos/matt-walters-how-to-cqrs-in-node-eventually-consistent-unidirectional-systems-with-microservices[how to cqrs in node talk]
